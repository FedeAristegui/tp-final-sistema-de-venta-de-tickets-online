<div class="contenedor">
  <!-- Formulario -->
  <div class="formulario-container">
    <h3>
      @if(isEditing) {
        Editar Evento
      } @else {
        Crear Nuevo Evento
      }
    </h3>

    <form [formGroup]="form" (ngSubmit)="handleSubmit()" class="formulario-evento">
      <label>T√≠tulo:</label>
      <input formControlName="titulo" placeholder="T√≠tulo del evento" />

      <label>Fecha:</label>
      <input formControlName="fecha" type="date" />

      <label>Hora:</label>
      <input formControlName="hora" type="time" />

      <label>Lugar:</label>
      <input formControlName="lugar" placeholder="Lugar del evento" />

      <label>Imagen (URL):</label>
      <input formControlName="imagen" placeholder="https://..." />

      <label>Modo de Venta:</label>
      <select formControlName="modoVenta" (change)="cambiarModoVenta()">
        <option value="sector">Venta por Sector</option>
        <option value="butaca">Venta por Butaca</option>
      </select>

      @if (form.get('modoVenta')?.value === 'sector') {
        <div class="sectores-block">
          <h4>Sectores</h4>
          <button type="button" (click)="agregarSector()">+ Agregar Sector</button>
          <div formArrayName="sectores">
            @for (s of sectores.controls; track $index; let i = $index) {
              <div [formGroupName]="i" class="sector-item">
                <label>Nombre:</label>
                <input formControlName="nombre" placeholder="Ej: VIP" />
                <label>Capacidad:</label>
                <input formControlName="capacidad" type="number" />
                <label>Precio:</label>
                <input formControlName="precio" type="number" />
                <button type="button" (click)="eliminarSector(i)" class="btn-eliminar-item">üóëÔ∏è Eliminar</button>
              </div>
            }
          </div>
        </div>
      } @else {
        <div class="butacas-block">
          <h4>Configuraci√≥n de Butacas</h4>
          
          <!-- üîπ Generador Autom√°tico de Butacas -->
          <div class="generador-butacas" [formGroup]="generadorButacas">
            <h5>üé´ Generador Autom√°tico de Butacas</h5>
            <p class="info-ayuda">
              Genera autom√°ticamente todas las butacas del evento especificando las filas y cantidad.
            </p>
            <div class="generador-campos">
              <div>
                <label>Filas <small>(A,B,C o A-E)</small>:</label>
                <input formControlName="filas" placeholder="Ejemplo: A-E" />
                <small class="hint">üí° Usa comas (A,B,C) o gui√≥n (A-E)</small>
              </div>
              <div>
                <label>Butacas por fila:</label>
                <input formControlName="butacasPorFila" type="number" placeholder="Ej: 10" min="1" />
                <small class="hint">üí° Cantidad de asientos por fila</small>
              </div>
              <div>
                <label>Precio por butaca ($):</label>
                <input formControlName="precioBase" type="number" placeholder="Ej: 1000" min="0" />
                <small class="hint">üí° Precio base para todas las butacas</small>
              </div>
            </div>
            
            @if (butacas.length > 0) {
              <div class="advertencia-reemplazo">
                ‚ö†Ô∏è Al generar se reemplazar√°n las {{ butacas.length }} butacas actuales
              </div>
            }
            
            <button type="button" (click)="generarButacas()" class="btn-generar">
              üé´ Generar Butacas Autom√°ticamente
            </button>
          </div>

          <hr />

          <!-- Vista previa de butacas -->
          <div formArrayName="butacas">
            @if (butacas.length > 0) {
              <div class="butacas-header">
                <h5>Butacas Creadas</h5>
                <div class="info-butacas">Total: {{ butacas.length }} butacas</div>
              </div>
              
              <!-- Opci√≥n de edici√≥n manual -->
              <div class="opciones-butacas">
                <button type="button" (click)="agregarButaca()" class="btn-agregar">+ Agregar Butaca Manual</button>
                <button type="button" (click)="limpiarButacas()" class="btn-limpiar">üóëÔ∏è Limpiar Todas</button>
              </div>
              
              <!-- Lista de butacas (solo mostrar primeras 20 para no saturar) -->
              <div class="lista-butacas">
                @for (b of butacas.controls; track $index; let i = $index) {
                  @if (i < 20 || mostrarTodasButacas()) {
                    <div [formGroupName]="i" class="butaca-item">
                      <div class="butaca-info">
                        <span class="butaca-label">Fila {{ b.get('fila')?.value }} - #{{ b.get('numero')?.value }}</span>
                        <span class="butaca-precio">${{ b.get('precio')?.value }}</span>
                      </div>
                      <div class="butaca-controles">
                        <label class="checkbox-disponible">
                          <input formControlName="disponible" type="checkbox" />
                          Disponible
                        </label>
                        <button type="button" (click)="eliminarButaca(i)" class="btn-eliminar-item">üóëÔ∏è</button>
                      </div>
                    </div>
                  }
                }
                
                @if (butacas.length > 20 && !mostrarTodasButacas()) {
                  <div class="ver-mas">
                    <p>Mostrando 20 de {{ butacas.length }} butacas</p>
                    <button type="button" (click)="toggleMostrarTodas()" class="btn-ver-mas">
                      Ver todas las butacas
                    </button>
                  </div>
                } @else if (butacas.length > 20 && mostrarTodasButacas()) {
                  <button type="button" (click)="toggleMostrarTodas()" class="btn-ver-mas">
                    Ver menos
                  </button>
                }
              </div>
            } @else {
              <div class="sin-butacas">
                <p>üìã No hay butacas creadas a√∫n</p>
                <p>Usa el generador autom√°tico o agrega butacas manualmente</p>
                <button type="button" (click)="agregarButaca()" class="btn-agregar">+ Agregar Primera Butaca</button>
              </div>
            }
          </div>
        </div>
      }

      <button type="submit">
        @if(isEditing) {
          Actualizar Evento
        } @else {
          Guardar Evento
        }
      </button>
      
      @if(isEditing) {
        <button type="button" (click)="cancelarEdicion()" class="cancelar-btn">Cancelar</button>
      }
      
    </form>
    @if(!isEditing){
      <button routerLink="/menu-principal" class="volver-btn">Volver al Men√∫ Principal</button>
    }
  </div>
</div>


