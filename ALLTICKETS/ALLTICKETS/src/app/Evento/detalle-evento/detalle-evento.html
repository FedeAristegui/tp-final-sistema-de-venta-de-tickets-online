@if (evento()) {
  <div class="detalle-evento">
    <div class="header-evento">
      <button (click)="volverAtras()" class="btn-volver">
        <span>‚Üê</span> Volver
      </button>
      @if (usuario()?.rol === 'admin') {
        <button class="editar" (click)="toggleEdit()" [disabled]="isEditing()">Editar</button>
      }
      <h1>{{ evento()!.titulo }}</h1>
    </div>

    @if (evento()!.imagen) {
      <div class="imagen-evento">
        <img [src]="evento()!.imagen" [alt]="evento()!.titulo" />
      </div>
    }

    <div class="info-basica">
      <div class="info-item">
        <span class="icono">üìÖ</span>
        <strong>Fecha:</strong> {{ evento()!.fecha | date : "dd/MM/yyyy" }}
      </div>
      <div class="info-item">
        <span class="icono">üïê</span>
        <strong>Hora:</strong> {{ evento()!.hora }}
      </div>
      <div class="info-item">
        <span class="icono">üìç</span>
        <strong>Lugar:</strong> {{ evento()!.lugar }}
      </div>
      <div class="info-item">
        <span class="icono">üé≠</span>
        <strong>Categor√≠a:</strong> {{ evento()!.categoria }}
      </div>
    </div>

    @if (evento()!.modoVenta === 'butaca') {
      <!-- MAPA DE BUTACAS -->
      <div class="mapa-butacas">
        <h2>Selecciona tus butacas</h2>
        
        <div class="escenario">
          <span>ESCENARIO</span>
        </div>

        <div class="butacas-container">
          @for (fila of filasOrdenadas(); track fila) {
            <div class="butacas-fila">
              <span class="fila-label">{{ fila }}</span>
              <div class="asientos">
                @for (butaca of butacasPorFila()[fila]; track butaca.numero) {
                  <button
                    class="butaca"
                    [class.disponible]="butaca.disponible"
                    [class.ocupada]="!butaca.disponible"
                    [class.seleccionada]="estaSeleccionada(fila, butaca.numero)"
                    [disabled]="!butaca.disponible"
                    (click)="seleccionarButaca(fila, butaca.numero, butaca.disponible)"
                    [title]="'Fila ' + fila + ' - Asiento ' + butaca.numero + ' - $' + butaca.precio"
                  >
                    {{ butaca.numero }}
                  </button>
                }
              </div>
            </div>
          }
        </div>

        <div class="leyenda">
          <div class="leyenda-item">
            <span class="butaca-ejemplo disponible"></span>
            <span>Disponible</span>
          </div>
          <div class="leyenda-item">
            <span class="butaca-ejemplo seleccionada"></span>
            <span>Seleccionada</span>
          </div>
          <div class="leyenda-item">
            <span class="butaca-ejemplo ocupada"></span>
            <span>Ocupada</span>
          </div>
        </div>

        @if (butacasSeleccionadas().length > 0) {
          <div class="resumen-seleccion">
            <h3>Butacas Seleccionadas</h3>
            <div class="butacas-seleccionadas-lista">
              @for (butaca of butacasSeleccionadas(); track butaca.fila + '-' + butaca.numero) {
                <span class="butaca-tag">
                  Fila {{ butaca.fila }} - Asiento {{ butaca.numero }}
                </span>
              }
            </div>
            <div class="total-container">
              <span class="total-label">Total:</span>
              <span class="total-precio">{{ totalButacas() | currency }}</span>
            </div>
            <div class="acciones">
              @if (usuario()?.rol !== 'admin') {
                <button (click)="limpiarSeleccion()" class="btn-limpiar">
                Limpiar Selecci√≥n
              </button>
              <button (click)="agregarAlCarrito()" class="btn-agregar">
                Agregar al Carrito
              </button>
              }  
            </div>
          </div>
        }
      </div>
    } @else {
      <!-- SELECCI√ìN POR SECTORES -->
      <div class="sectores-container">
        <h2>Selecciona tu sector</h2>
        
        <div class="sectores-grid">
          @for (sector of evento()!.sectores; track sector.nombre) {
            <div 
              class="sector-card"
              [class.seleccionado]="sectorSeleccionado() === sector.nombre"
              [class.sin-capacidad]="sector.capacidad === 0"
              (click)="sector.capacidad > 0 && seleccionarSector(sector.nombre)"
            >
              <h3>{{ sector.nombre }}</h3>
              <div class="sector-precio">{{ sector.precio | currency }}</div>
              <div class="sector-capacidad">
                <div class="capacidad-barra">
                  <div 
                    class="capacidad-progreso"
                    [style.width.%]="(sector.capacidad / getCapacidadDisponible(sector.nombre)) * 100"
                  ></div>
                </div>
                <span class="capacidad-texto">
                  {{ sector.capacidad }} disponibles
                </span>
              </div>
            </div>
          }
        </div>

        @if (sectorSeleccionado()) {
          <div class="cantidad-selector">
            <h3>¬øCu√°ntas entradas? (M√°ximo 10 entradas)</h3>
            <div class="contador">
              <button 
                (click)="disminuirCantidad()" 
                [disabled]="cantidadSector() <= 1"
                class="btn-contador"
              >
                ‚àí
              </button>
              <span class="cantidad-display">{{ cantidadSector() }}</span>
              <button 
                (click)="aumentarCantidad()" 
                [disabled]="cantidadSector() >= getCapacidadDisponible(sectorSeleccionado())"
                [disabled]="cantidadSector() > 9"
                class="btn-contador"
              >
                +
              </button>
            </div>
            <div class="total-container">
              <span class="total-label">Total:</span>
              <span class="total-precio">{{ totalSector() | currency }}</span>
            </div>
            @if (usuario()?.rol !== 'admin') {
              <button (click)="agregarAlCarrito()" class="btn-agregar">
              Agregar al Carrito
            </button>
            } 
          </div>
        }
      </div>
    }
  </div>
  @if (isEditing()) {
    <app-admin-eventos
      id="form-edicion"
      [isEditing]="true"
      [evento]="evento()" 
      (edited)="handleEdit($event)" 
      (cancelled)="toggleEdit()">
        </app-admin-eventos>
    }

}