<div class="contenedor">
  <div class="formulario-container">

    @if (isEditing()) {
      <h3>Modificar Descuento</h3>
    } @else {
      <h3>Registrar Descuento</h3>
    }

    <form [formGroup]="form" (ngSubmit)="handleSubmit()">
      <label for="codigo">Código:</label>
      <input id="codigo" type="text" formControlName="codigo" />
      @if (codigo.invalid && (codigo.dirty || codigo.touched)) {
        <div class="error">
          @if (codigo.errors?.['required']) {
            <span>El código es requerido</span>
          }
        </div>
      }

      <label for="porcentaje">Porcentaje:</label>
      <input id="porcentaje" type="number" formControlName="porcentaje" min="1" max="100" />
      @if (porcentaje.invalid && (porcentaje.dirty || porcentaje.touched)) {
        <div class="error">
          @if (porcentaje.errors?.['required']) {
            <span>El porcentaje es requerido</span>
          }
          @if (porcentaje.errors?.['min']) {
            <span>El porcentaje debe ser mayor que 0</span>
          }
          @if (porcentaje.errors?.['max']) {
            <span>El porcentaje no puede exceder 100</span>
          }
        </div>
      }

      <label for="fechaInicio">Fecha de inicio:</label>
      <input id="fechaInicio" type="date" formControlName="fechaInicio" />
      @if (fechaInicio.invalid && (fechaInicio.dirty || fechaInicio.touched)) {
        <div class="error">
          @if (fechaInicio.errors?.['required']) {
            <span>La fecha de inicio es requerida</span>
          }
          @if (fechaInicio.errors?.['minDateToday']) {
            <span>La fecha debe ser hoy o posterior</span>
          }
        </div>
      }

      <label for="fechaFin">Fecha de fin:</label>
      <input id="fechaFin" type="date" formControlName="fechaFin" />
      @if (fechaFin.invalid && (fechaFin.dirty || fechaFin.touched)) {
        <div class="error">
          @if (fechaFin.errors?.['required']) {
            <span>La fecha de fin es requerida</span>
          }
        </div>
      }
      @if (form.errors?.['dateFinInvalid'] && (fechaFin.dirty || fechaFin.touched)) {
        <div class="error">
          <span>La fecha de fin debe ser al menos 1 día después de la fecha de inicio</span>
        </div>
      }

      <label for="activo">
        <input id="activo" type="checkbox" formControlName="activo" />
        Activo
      </label>
      <button type="submit">
        {{ isEditing() ? 'Actualizar' : 'Crear' }} descuento
      </button>

      @if (isEditing()) {
        <button type="button" (click)="cancelarEdicion()" class="cancelar-btn">
          Cancelar
        </button>
      }

    </form>
  </div>
</div>
